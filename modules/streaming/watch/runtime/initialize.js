import{handleInteractMedia}from"/modules/util";import{HMSDurationToSeconds}from"/modules/utility/utility/date";const disposePlayer=e=>{try{var t;window?.videojs?.players&&(t=window.videojs.players)&&Object.keys(t).length&&t[e]&&t[e].dispose()}catch(e){}},setTimeline=(o,e)=>{console.log(o,e,window?.VTTCue);try{if(o&&e?.timeline&&window?.VTTCue){const a=o.addRemoteTextTrack({kind:"metadata",mode:"showing"},!1).track,r=e.timeline.filter(e=>"clip"===e.type),d=e?.duration?HMSDurationToSeconds(e.duration):0,l=o?.controlBar?.progressControl?.el();r.forEach((e,t)=>{var n=e.startOffset,i=e?.endOffset??(r[t+1]&&r[t+1].startOffset)?r[t+1].startOffset-1:d??0,e=e.name,i=new window.VTTCue(n,i,e);a.addCue(i),l&&o?.id_&&(0===t&&((e=document.createElement("div")).className="segmentContainer",e.id=o.id_+"_segmentContainer",l.appendChild(e)),(i=document.getElementById(o.id_+"_segmentContainer"))&&((t=document.createElement("div")).classList.add("vjs-segment-square"),e=n/d*100,t.style.left=e+"%",i.appendChild(t)),console.log("Seek",l))}),o.on("timeupdate",function(){})}}catch(e){}},initializePlayer=(i,o,a,r,e,d,l=[],s,c,y,m,u,t,p)=>{try{if(window.videojs){if(console.log("Run Init",r,document.getElementById(r)),!window.videojs.players[r]||e.force)return window.videojs(r,e,async function(){if(d?.current){y&&y(!0),window.videojs.log(`Your player ${r} is ready!`),console.log(d.current);for(let e=0;e<l.length;e++){var t=d.current.controlBar.addChild("button"),n=t.el();n.innerHTML=l[e].innerHTML??"",l[e].className&&t.addClass(l[e].className),l[e].btnEvent&&(n.removeEventListener("click",l[e].btnEvent),n.addEventListener("click",l[e].btnEvent))}this.on("error",e=>{console.log("Error",r),s&&s(e)}),this.on("ready",e=>{o?.id&&i&&a?.trying&&(handleInteractMedia(i,i.watchData,a.trying),setTimeline(this,o)),m&&m(e?.target?.player??this,o)}),this.on("play",e=>{p&&p(e),u&&u(!0)}),this.on("ended",e=>{console.log("Ended",r),c&&c()})}});if(document.getElementById(r)){var n=document.getElementById(r);if(console.log(`Player ${r} already initialized`,n,n?.player.hasStarted(),t),!n?.player?.hasStarted())try{try{window?.userInteracted||n.player.muted(!0)}catch(e){}n.player.play()}catch(e){console.log("Failed to play",e)}}}}catch(e){}};export{disposePlayer,initializePlayer};