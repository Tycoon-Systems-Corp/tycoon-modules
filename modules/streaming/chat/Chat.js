"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _react=_interopRequireDefault(require("react")),_link=_interopRequireDefault(require("next/link")),_uuid=require("uuid"),_reactTextareaAutosize=_interopRequireDefault(require("react-textarea-autosize")),_socket=require("../../utility/socket"),_util=require("../../util"),_ChatModule=_interopRequireDefault(require("./Chat.module.scss")),_utility=require("./utility"),_Close=_interopRequireDefault(require("@mui/icons-material/Close")),_Reply=_interopRequireDefault(require("@mui/icons-material/Reply")),_ArrowUpward=_interopRequireDefault(require("@mui/icons-material/ArrowUpward")),_Tooltip=_interopRequireDefault(require("@mui/material/Tooltip"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _regeneratorRuntime(){_regeneratorRuntime=function(){return l};var c,l={},e=Object.prototype,u=e.hasOwnProperty,s=Object.defineProperty||function(e,t,r){e[t]=r.value},t="function"==typeof Symbol?Symbol:{},n=t.iterator||"@@iterator",r=t.asyncIterator||"@@asyncIterator",a=t.toStringTag||"@@toStringTag";function o(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{o({},"")}catch(c){o=function(e,t,r){return e[t]=r}}function i(e,t,r,n){var a,o,l,i,t=t&&t.prototype instanceof y?t:y,t=Object.create(t.prototype),n=new L(n||[]);return s(t,"_invoke",{value:(a=e,o=r,l=n,i=f,function(e,t){if(i===_)throw new Error("Generator is already running");if(i===m){if("throw"===e)throw t;return{value:c,done:!0}}for(l.method=e,l.arg=t;;){var r=l.delegate;if(r){r=function e(t,r){var n=r.method,a=t.iterator[n];if(a===c)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=c,e(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),g;n=d(a,t.iterator,r.arg);if("throw"===n.type)return r.method="throw",r.arg=n.arg,r.delegate=null,g;a=n.arg;return a?a.done?(r[t.resultName]=a.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=c),r.delegate=null,g):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,g)}(r,l);if(r){if(r===g)continue;return r}}if("next"===l.method)l.sent=l._sent=l.arg;else if("throw"===l.method){if(i===f)throw i=m,l.arg;l.dispatchException(l.arg)}else"return"===l.method&&l.abrupt("return",l.arg);i=_;r=d(a,o,l);if("normal"===r.type){if(i=l.done?m:h,r.arg===g)continue;return{value:r.arg,done:l.done}}"throw"===r.type&&(i=m,l.method="throw",l.arg=r.arg)}})}),t}function d(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}l.wrap=i;var f="suspendedStart",h="suspendedYield",_="executing",m="completed",g={};function y(){}function p(){}function v(){}var t={},C=(o(t,n,function(){return this}),Object.getPrototypeOf),C=C&&C(C(S([]))),E=(C&&C!==e&&u.call(C,n)&&(t=C),v.prototype=y.prototype=Object.create(t));function b(e){["next","throw","return"].forEach(function(t){o(e,t,function(e){return this._invoke(t,e)})})}function T(l,i){var t;s(this,"_invoke",{value:function(r,n){function e(){return new i(function(e,t){!function t(e,r,n,a){var o,e=d(l[e],l,r);if("throw"!==e.type)return(r=(o=e.arg).value)&&"object"==_typeof(r)&&u.call(r,"__await")?i.resolve(r.__await).then(function(e){t("next",e,n,a)},function(e){t("throw",e,n,a)}):i.resolve(r).then(function(e){o.value=e,n(o)},function(e){return t("throw",e,n,a)});a(e.arg)}(r,n,e,t)})}return t=t?t.then(e,e):e()}})}function w(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function A(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function L(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(w,this),this.reset(!0)}function S(t){if(t||""===t){var r,e=t[n];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length))return r=-1,(e=function e(){for(;++r<t.length;)if(u.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=c,e.done=!0,e}).next=e}throw new TypeError(_typeof(t)+" is not iterable")}return s(E,"constructor",{value:p.prototype=v,configurable:!0}),s(v,"constructor",{value:p,configurable:!0}),p.displayName=o(v,a,"GeneratorFunction"),l.isGeneratorFunction=function(e){e="function"==typeof e&&e.constructor;return!!e&&(e===p||"GeneratorFunction"===(e.displayName||e.name))},l.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,v):(e.__proto__=v,o(e,a,"GeneratorFunction")),e.prototype=Object.create(E),e},l.awrap=function(e){return{__await:e}},b(T.prototype),o(T.prototype,r,function(){return this}),l.AsyncIterator=T,l.async=function(e,t,r,n,a){void 0===a&&(a=Promise);var o=new T(i(e,t,r,n),a);return l.isGeneratorFunction(t)?o:o.next().then(function(e){return e.done?e.value:o.next()})},b(E),o(E,a,"Generator"),o(E,n,function(){return this}),o(E,"toString",function(){return"[object Generator]"}),l.keys=function(e){var t,r=Object(e),n=[];for(t in r)n.push(t);return n.reverse(),function e(){for(;n.length;){var t=n.pop();if(t in r)return e.value=t,e.done=!1,e}return e.done=!0,e}},l.values=S,L.prototype={constructor:L,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=c,this.done=!1,this.delegate=null,this.method="next",this.arg=c,this.tryEntries.forEach(A),!e)for(var t in this)"t"===t.charAt(0)&&u.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=c)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(r){if(this.done)throw r;var n=this;function e(e,t){return o.type="throw",o.arg=r,n.next=e,t&&(n.method="next",n.arg=c),!!t}for(var t=this.tryEntries.length-1;0<=t;--t){var a=this.tryEntries[t],o=a.completion;if("root"===a.tryLoc)return e("end");if(a.tryLoc<=this.prev){var l=u.call(a,"catchLoc"),i=u.call(a,"finallyLoc");if(l&&i){if(this.prev<a.catchLoc)return e(a.catchLoc,!0);if(this.prev<a.finallyLoc)return e(a.finallyLoc)}else if(l){if(this.prev<a.catchLoc)return e(a.catchLoc,!0)}else{if(!i)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return e(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;0<=r;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&u.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var a=n;break}}var o=(a=a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc?null:a)?a.completion:{};return o.type=e,o.arg=t,a?(this.method="next",this.next=a.finallyLoc,g):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),A(r),g}},catch:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var r,n,a=this.tryEntries[t];if(a.tryLoc===e)return"throw"===(r=a.completion).type&&(n=r.arg,A(a)),n}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:S(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=c),g}},l}function asyncGeneratorStep(e,t,r,n,a,o,l){try{var i=e[o](l),c=i.value}catch(e){return void r(e)}i.done?t(c):Promise.resolve(c).then(n,a)}function _asyncToGenerator(i){return function(){var e=this,l=arguments;return new Promise(function(t,r){var n=i.apply(e,l);function a(e){asyncGeneratorStep(n,t,r,a,o,"next",e)}function o(e){asyncGeneratorStep(n,t,r,a,o,"throw",e)}a(void 0)})}}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){var r;if(e)return"string"==typeof e?_arrayLikeToArray(e,t):"Map"===(r="Object"===(r=Object.prototype.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:r)||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(e,t):void 0}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function _iterableToArrayLimit(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,a,o,l,i=[],c=!0,u=!1;try{if(o=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=o.call(r)).done)&&(i.push(n.value),i.length!==t);c=!0);}catch(e){u=!0,a=e}finally{try{if(!c&&null!=r.return&&(l=r.return(),Object(l)!==l))return}finally{if(u)throw a}}return i}}function _arrayWithHoles(e){if(Array.isArray(e))return e}var CONNECT_THRESHOLD=12500,ADHOC_BLOCK_CHAT=1500,RECENT_CHAT_THRESHOLD=2e4,RECENT_CHAT_TIMEOUT=1e4,MAX_RECENT_CHATS=9,Module=function(a){function o(e){console.log("Manage Chats",e,p);var t=p;e&&t.push({chat:e,time:(new Date).getTime()});for(var r=0;r<t.length;r++)t[r].time<(new Date).getTime()-RECENT_CHAT_THRESHOLD&&t.splice(r,1);K(t),oe(t)}function H(e){var t;null!=e&&null!=(t=e.target)&&t.getAttribute("username")&&null!=e&&null!=(t=e.target)&&t.getAttribute("author")&&(t=e.target.getAttribute("username"),e=e.target.getAttribute("author"),T({user:t,id:e}),ae())&&(0,_utility.scrollChatDown)(O,"instant")}function j(e){var t=null!=e&&e.target.getAttribute("logid")?e.target:e.target.parentElement,t=null!=e&&e.target.getAttribute("logid")?e.target:e.target.parentElement;if(console.log(e),t.getAttribute("logid")&&t.getAttribute("username")&&t.getAttribute("author")){var r=t.getAttribute("logid"),e=t.getAttribute("username"),t=t.getAttribute("author");if(r&&e&&t){S(r),R(e);t=f.find(function(e){return e.id===r});if(null!=t&&t.content&&null!=t&&t.username){for(var n=[],a=(n.push({id:r,username:t.username,content:t.content,replyLogid:null!=(e=t.replyLogid)?e:null}),0);a<3&&!function(t){if(null!=(e=n[t])&&e.replyLogid){var e=f.find(function(e){return e.id===(null==(e=n[t])?void 0:e.replyLogid)});if(!e)return 1;n.push({id:e.id,username:e.username,content:e.content,replyLogid:null!=(e=e.replyLogid)?e:null})}}(a);a++);$(n)}}}}function F(e){var t=null!=e&&e.target.getAttribute("logid")?e.target:e.target.parentElement,t=null!=e&&e.target.getAttribute("logid")?e.target:e.target.parentElement;console.log(t),t.getAttribute("logid")&&(e=t.getAttribute("logid"),t=document.querySelector("div[logid='".concat(e,"']")),console.log(t),null!=t)&&t.scrollIntoView&&(M(e),-1<Q&&clearTimeout(Q),e=setTimeout(function(){M(null)},1e4),Z(e),t.scrollIntoView({behavior:"smooth",block:"center"}))}function e(){var e;n&&null!=a&&a._isMobile&&((null==(e=document)?void 0:e.activeElement)!==(null==k?void 0:k.current)||I?document&&document.activeElement&&(null==(e=document)?void 0:e.activeElement)===(null==k?void 0:k.current)||!I||(ee(!1),null!=a&&a.setMobileStyleConfigs&&a.setMobileStyleConfigs(!1)):(ee(!0),window&&setTimeout(function(){window.scrollTo({top:0,behavior:"smooth"})},250),null!=a&&a.setMobileStyleConfigs&&a.setMobileStyleConfigs(!0)))}var t,r=_slicedToArray(_react.default.useState(!1),2),n=r[0],q=r[1],r=_slicedToArray(_react.default.useState(null),2),U=(r[0],r[1]),r=_slicedToArray(_react.default.useState(!1),2),l=r[0],i=r[1],r=_slicedToArray(_react.default.useState(!1),2),c=r[0],u=r[1],r=_slicedToArray(_react.default.useState({}),2),s=r[0],G=r[1],r=_slicedToArray(_react.default.useState(!1),2),d=r[0],B=r[1],r=_slicedToArray(_react.default.useState(null),2),f=r[0],P=r[1],r=_slicedToArray(_react.default.useState(!1),2),h=r[0],_=r[1],r=_slicedToArray(_react.default.useState(!1),2),m=r[0],g=r[1],r=_slicedToArray(_react.default.useState(!1),2),z=r[0],y=r[1],r=_slicedToArray(_react.default.useState(-1),2),W=(r[0],r[1]),r=_slicedToArray(_react.default.useState([]),2),p=r[0],K=r[1],r=_slicedToArray(_react.default.useState(null),2),v=r[0],C=r[1],r=_slicedToArray(_react.default.useState({}),2),E=r[0],V=r[1],r=_slicedToArray(_react.default.useState(null),2),b=r[0],T=r[1],r=_slicedToArray(_react.default.useState(null),2),w=r[0],Y=r[1],r=_slicedToArray(_react.default.useState(-1),2),A=r[0],X=r[1],r=_slicedToArray(_react.default.useState(null),2),L=r[0],S=r[1],r=_slicedToArray(_react.default.useState(null),2),N=r[0],R=r[1],r=_slicedToArray(_react.default.useState([]),2),x=r[0],$=r[1],r=_slicedToArray(_react.default.useState(null),2),J=r[0],M=r[1],r=_slicedToArray(_react.default.useState(-1),2),Q=r[0],Z=r[1],r=_slicedToArray(_react.default.useState(!1),2),I=r[0],ee=r[1],k=_react.default.useRef(),O=_react.default.useRef(),D=_react.default.useRef(),te=(_react.default.useEffect(function(){var e;n||(e=(0,_uuid.v4)(),U(e),q(!0))},[n]),_react.default.useEffect(function(){a._LocalEventEmitter&&(a._LocalEventEmitter.unsubscribe("receive_chat"),a._LocalEventEmitter.subscribe("receive_chat",function(e){if(e)for(var r=Object.entries(e),n=0;n<r.length&&!function(){var e,t;if(r[n][0]&&r[n][0]===d&&r[n][1])return console.log(r[n][1],f),e=!f||f.length<50,t=null!=f&&f.length?r[n][1].length-f.length:0,setTimeout(function(){(ae(t)||e)&&(0,_utility.scrollChatDown)(O,f?"smooth":"instant")},50),P(r[n][1]),1}();n++);}))},[a._LocalEventEmitter,a.chatConfig,d,O.current,D.current,f]),_react.default.useEffect(function(){a._LocalEventEmitter&&(a._LocalEventEmitter.unsubscribe("receive_ban_table"),a._LocalEventEmitter.subscribe("receive_ban_table",function(e){if(console.log(e),e)for(var t=Object.entries(e),r=0;r<Object.entries(t).length;r++){var n="".concat(a.chatFor,"-chat-").concat(a.dborigin);if(t[r][0]&&t[r][0]===n){console.log("Setting ban table",t[r][1]),Y(null!=(n=t[r][1])?n:{});break}}}))},[a._LocalEventEmitter,a.chatFor,a.dborigin]),_react.default.useEffect(function(){a._LocalEventEmitter&&(a._LocalEventEmitter.unsubscribe("join_chat_waiting"),a._LocalEventEmitter.subscribe("join_chat_waiting",function(e){var t="".concat(a.chatFor,"-chat");te(t)}))},[l,a._socket,a.dborigin,a._rooms,a.chatFor,a._loggedIn,a.dborigin,c,s,d]),_react.default.useEffect(function(){var e;null!=a&&a.videoStatus&&null!=a&&null!=(e=a._loggedIn)&&e.identifier&&null!=a&&null!=(e=a._loggedIn)&&e.hash&&a.chatFor&&-1<["live"].indexOf(a.videoStatus)?u(!0):u(!1)},[a._loggedIn,a.chatFor,a.videoStatus,c]),_react.default.useEffect(function(){console.log(l,a._rooms,a._socket,a.chatFor);var e="".concat(a.chatFor,"-chat");te(e),re(),o()},[l,a._socket,a.dborigin,a._rooms,a.chatFor,a._loggedIn,a.dborigin,c,s,d,o]),function(e){try{var t,r;d&&"".concat(a.chatFor,"-chat-").concat(a.dborigin)===d&&f||(console.log(a._rooms.rooms.indexOf("".concat(e,"-").concat(a.dborigin)),a._rooms,"".concat(e,"-").concat(a.dborigin)),!l&&a._rooms&&c&&(!a._rooms.rooms||a._rooms.rooms.indexOf("".concat(e,"-").concat(a.dborigin))<0||!f)&&((0,_util.isObjectEmpty)(s)||s.time<(new Date).getTime()-CONNECT_THRESHOLD&&s.attempt<5)&&(i(!0),setTimeout(function(){i(!1),setTimeout(function(){a._LocalEventEmitter.dispatch("join_chat_waiting",{})},500)},(null!=(t=s.attempt)?t:1)*CONNECT_THRESHOLD),(0,_socket.joinChat)(a._socket,a._loggedIn,a.dborigin,e,null!=(r=s.attempt)?r:1),G({time:(new Date).getTime(),attempt:s.attempt?s.attempt+1:2})))}catch(e){}}),re=function(){var e,t;a.chatFor&&(t="".concat(a.chatFor,"-chat"),a.dborigin)&&-1<(null==a||null==(e=a._rooms)||null==(e=e.rooms)?void 0:e.indexOf("".concat(t,"-").concat(a.dborigin)))&&d!=="".concat(t,"-").concat(a.dborigin)&&B("".concat(t,"-").concat(a.dborigin))},ne=function(){var t=_asyncToGenerator(_regeneratorRuntime().mark(function e(t){var r,n;return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:null!=k&&null!=(r=k.current)&&r.value&&!h&&(r=k.current.value,console.log("Chat To Send",r),a.chatFor&&a._socket&&null!=a&&null!=(n=a._loggedIn)&&n.username&&null!=a&&null!=(n=a._loggedIn)&&n.identifier&&null!=a&&null!=(n=a._loggedIn)&&n.hash&&a.dborigin&&(n="".concat(a.chatFor,"-chat"),o(r),(0,_socket.sendChat)(a._socket,a._loggedIn,a.dborigin,n,r,L,N),S(null),R(null)),g(!0),W((new Date).getTime()),setTimeout(function(){g(!1),setTimeout(function(){null!=k&&k.current&&k.current.select()},50)},ADHOC_BLOCK_CHAT),setTimeout(function(){(0,_utility.scrollChatDown)(O,"smooth")},250),k.current.value="",k.current.setAttribute("style","height: 1.35rem"));case 1:case"end":return e.stop()}},e)}));return function(e){return t.apply(this,arguments)}}(),ae=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0;if(null!=O&&O.current&&null!=D&&D.current){var t=e*(null!=(t=null==a||null==(t=a.chatConfig)?void 0:t.chatItemHeight)?t:17.5),e=(console.log(O.current.scrollTop,D.current.clientHeight-O.current.clientHeight,e,t,O.current.scrollTop+t),O.current.clientHeight+100);if(console.log(O.current.scrollTop+t,D.current.clientHeight-e),O.current.scrollTop+t>D.current.clientHeight-e)return!0}return!1},oe=function(e){(null!=e?e:p).length>MAX_RECENT_CHATS&&!v&&(_(!0),y(!0),e=setTimeout(function(){_(!1),y(!1),C(null)},RECENT_CHAT_TIMEOUT),null!=v&&v.r&&clearTimeout(v.r),C({r:e,time:(new Date).getTime()+RECENT_CHAT_TIMEOUT}))},r=(_react.default.useEffect(function(){var e,t=E,r=!1;(null==a||null==(e=a.watchData)?void 0:e.author)!==(null==(e=a._loggedIn)?void 0:e.identifier)||E.canBan||(t.canBan=r=!0,!w&&A<(new Date).getTime()-10&&(X((new Date).getTime()),e="".concat(a.chatFor,"-chat"),(0,_socket.requestBanTable)(a._socket,a._loggedIn,a.dborigin,e))),r&&V(t)},[a.watchData,a._loggedIn,E,w,a.chatFor,a._socket,a.dborigin,A]),e(),null!=(r=null==a||null==(r=a.chatConfig)?void 0:r.menuThreadOffset)?r:2.85),le=null==a||null==(t=a.chatConfig)?void 0:t.replyOff;return console.log("Chat Log",f,Array.isArray(f),a.className,p,a,b,w,r,m,h),_react.default.createElement("div",{className:"".concat(a.className," ").concat(_ChatModule.default.chatContainer," Chat_ChatContainer"),onClick:function(){e()}},b?_react.default.createElement("div",{className:"".concat(_ChatModule.default.userDisplayContainer," Chat_UserDisplayContainer")},_react.default.createElement("div",null,_react.default.createElement("div",{className:"Chat_UserDisplayInternalContainer",style:{display:"flex",gap:".25rem"}},_react.default.createElement("div",{className:"Chat_UserDisplayUser"},_react.default.createElement(_link.default,{href:"/p?u=".concat(b.user),style:{alignSelf:"center"}},b.user)),null!=E&&E.canBan&&b.id!==a._loggedIn.identifier?w&&w[b.id]?_react.default.createElement("button",{style:{fontSize:".75rem",padding:".125rem .25rem"},onClick:function(e){var t;null!=e&&null!=(t=e.target)&&t.getAttribute("userid")&&(t="".concat(a.chatFor,"-chat"),(0,_socket.attemptBanUserChat)(a._socket,a._loggedIn,a.dborigin,t,e.target.getAttribute("userid"),{unban:!0}))},userid:"".concat(b.id)},"Unban User"):_react.default.createElement("button",{style:{fontSize:".75rem",padding:".125rem .25rem"},onClick:function(e){var t;null!=e&&null!=(t=e.target)&&t.getAttribute("userid")&&(t="".concat(a.chatFor,"-chat"),(0,_socket.attemptBanUserChat)(a._socket,a._loggedIn,a.dborigin,t,e.target.getAttribute("userid")))},userid:"".concat(b.id)},"Ban User"):null)),_react.default.createElement(_Close.default,{className:"".concat(_ChatModule.default.close),onClick:function(e){T(null)},modif:"close"})):null,_react.default.createElement("div",{className:"".concat(_ChatModule.default.chatLogExternalContainer," ").concat(I?"".concat(_ChatModule.default.mobileChatLogExternalContainer):null," Chat_ChatLogExternalContainer"),ref:O},_react.default.createElement("div",{className:"".concat(_ChatModule.default.chatLogContainer," Chat_ChatLogContainer"),ref:D},f&&Array.isArray(f)?f.map(function(e,t){return _react.default.createElement("div",{className:"Chat_ChatLogItemContainer",key:t,index:t},e.id&&e.content&&e.author?_react.default.createElement("div",{className:"Chat_ChatLogItemInternalContainer",logid:e.id,time:e.time,author:e.author,replylogid:null!=(t=e.replyLogid)?t:null,replyusername:e.replyUsername},_react.default.createElement("div",{className:"".concat(_ChatModule.default.chatLogMain," ").concat(J===e.id?"".concat(_ChatModule.default.highlightedChat):""," Chat_ChatLogMain")},_react.default.createElement("div",{className:"".concat(_ChatModule.default.username," ").concat(_ChatModule.default.usernameChat," Chat_ChatUsername"),username:e.username,author:e.author,onClick:H},e.username),le?null:_react.default.createElement(_react.default.Fragment,null,e.replyLogid&&e.replyUsername?_react.default.createElement("div",{className:"".concat(_ChatModule.default.replyMeta)},_react.default.createElement("div",null,"Chat is Reply to ",_react.default.createElement("b",null,"@",e.replyUsername))):_react.default.createElement("div",{className:"".concat(_ChatModule.default.replyMeta)},_react.default.createElement("div",null,"Reply to ",_react.default.createElement("b",null,"@",e.username)))),_react.default.createElement("div",{className:"Chat_Content"},e.content),le?null:_react.default.createElement(_react.default.Fragment,null,e.replyLogid?_react.default.createElement("div",{className:"".concat(_ChatModule.default.viewReplyTo," Chat_ViewReplyTo"),onClick:F,logid:e.replyLogid,style:{marginTop:".25rem"}},_react.default.createElement(_ArrowUpward.default,{logid:e.replyLogid})):null,_react.default.createElement("div",{className:"".concat(_ChatModule.default.replyTo," Chat_ReplyTo"),onClick:j,logid:e.id,username:e.username,author:e.author,style:{marginTop:".25rem"}},_react.default.createElement(_Reply.default,{logid:e.id,username:e.username,author:e.author}))))):_react.default.createElement(_react.default.Fragment,null))}):_react.default.createElement("div",null))),_react.default.createElement("div",{className:"".concat(_ChatModule.default.chatInputContainer," ").concat(a.chatState?null:"".concat(_ChatModule.default.forceHideChat)," Chat_ChatInputContainer")},_react.default.createElement("div",{className:"".concat(_ChatModule.default.chatInputInternalContainer," Chat_ChatInputInternalContainer")},v?_react.default.createElement("div",{className:"".concat(_ChatModule.default.chatWarningContainer," Chat_ChatWarningContainer")},_react.default.createElement("div",{className:"".concat(_ChatModule.default.warningText," Chat_WarningText")},v?"Timed Out":""),null!=p&&p.length?_react.default.createElement("div",{className:"".concat(_ChatModule.default.warningBody),style:{fontSize:".85rem"}},"You have sent ",p.length," recent chats"):null):null,L&&N?_react.default.createElement("div",null,x&&Array.isArray(x)&&0<x.length?_react.default.createElement("div",{className:"".concat(_ChatModule.default.replyToRepliesContainer," Chat_ReplyToRepliesContainer"),style:{top:"-".concat(4<x.length?4+r:x.length+r,"rem")}},_react.default.createElement("div",{className:"".concat(_ChatModule.default.threadLabel," Chat_ThreadLabel")},"Thread"),x.slice(0).reverse().map(function(e,t){return t<4?_react.default.createElement("div",{className:"".concat(_ChatModule.default.replyToRepliesThread," Chat_ReplyToRepliesThread"),style:{display:"flex",gap:".25rem"},key:t,index:t},_react.default.createElement("div",{className:"Chat_ReplyToRepliesUsername"},_react.default.createElement("b",null,null!=(t=e.username)?t:"")),_react.default.createElement("div",{className:"Chat_ReplyToRepliesContent"},null!=(t=e.content)?t:"")):null})):null,_react.default.createElement("div",{className:"".concat(_ChatModule.default.replyToContainer," Chat_ReplyToContainer"),replytoid:L},_react.default.createElement("div",{className:"Chat_ReplyingToUsername"},"Replying to ",_react.default.createElement("b",null,"@",N)),_react.default.createElement(_Tooltip.default,{title:"Cancel Reply",placement:"top"},_react.default.createElement(_Close.default,{onClick:function(e){S(null),R(null)},className:"".concat(_ChatModule.default.chatCancelReplyTo),sx:{height:"17.5px"}})))):null,_react.default.createElement("div",{className:"".concat(_ChatModule.default.chatInputSendContainer," Chat_ChatInputSendContainer")},_react.default.createElement(_reactTextareaAutosize.default,{className:"".concat(_ChatModule.default.textChatInput," ").concat(_ChatModule.default.highlightBorder," Chat_TextChatInput"),ref:k,onKeyPress:function(e){(0,_utility.handleKeyPressChat)(e,ne)},onChange:function(e){},disabled:h||!d}),_react.default.createElement("button",{className:"".concat(_ChatModule.default.send," ").concat(_ChatModule.default.highlightBorder," Chat_Send"),onClick:ne,disabled:m||z},"Send")))))},_default=exports.default=Module;