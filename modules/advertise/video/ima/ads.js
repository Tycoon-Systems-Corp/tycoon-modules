let vast=null;import{throttleFunctionCall}from"/modules/util";const handleLoadIMA=(e,n)=>{if(vast=n)console.log("Window",window,e),"undefined"!=typeof window&&window?.google?loadIMA(e):setTimeout(()=>{handleLoadIMA(e)},1e3);else try{window.imaAdManagerDidLoad=!0}catch(e){}},loadIMA=e=>{var n,o,t,i,a=!1,s=document.getElementById(e);function d(e){console.log("ad container clicked"),console.log(i,s),s.paused?i.resume():s.pause()}function l(e){m(),window.imaPlaying=!0,console.log("Ad Started!"),n?.classList.contains("no_pointer_events")&&n.classList.remove("no_pointer_events"),s.classList.contains("no_pointer_events")||s.classList.add("no_pointer_events")}function r(e){window.imaPlaying=!1,n?.classList.contains("no_pointer_events")||n.classList.add("no_pointer_events"),s.classList.contains("no_pointer_events")&&s.classList.remove("no_pointer_events")}function c(e){window.imaPlaying=!1,n?.classList.contains("no_pointer_events")||n.classList.add("no_pointer_events"),s.classList.contains("no_pointer_events")&&s.classList.remove("no_pointer_events")}function g(e){try{throttleFunctionCall(window,"_onAdProgress",1500,e=>{try{m(),A(),window.imaPlaying=!0,s.pause()}catch(e){}},[e])}catch(e){}}function v(e){console.log("Loaded",e,s),window.imaAdManagerDidLoad=!0,(i=e.getAdsManager(s)).addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,E),i.addEventListener(google.ima.AdEvent.Type.CONTENT_PAUSE_REQUESTED,L),i.addEventListener(google.ima.AdEvent.Type.CONTENT_RESUME_REQUESTED,_),i.addEventListener(google.ima.AdEvent.Type.LOADED,u),i.addEventListener(google.ima.AdEvent.Type.AD_STARTED,l),i.addEventListener(google.ima.AdEvent.Type.AD_STOPPED,r),i.addEventListener(google.ima.AdEvent.Type.ALL_ADS_COMPLETED,c),i.addEventListener(google.ima.AdEvent.Type.AD_PROGRESS,g)}function E(e){console.log(e?.getError()),i?.destroy&&i.destroy()}function A(){var e,n;i?.resize&&(e=s.clientWidth,n=s.clientHeight,i.resize(e,n,google.ima.ViewMode.NORMAL))}function L(){window.imaPlaying=!0,n?.classList.contains("no_pointer_events")&&n.classList.remove("no_pointer_events"),m(),s.pause()}function _(){window.imaPlaying=!1,n?.classList.contains("no_pointer_events")||n.classList.add("no_pointer_events"),m(),console.log("VideoEleme",s),window.isAuthorized&&s.play()}function m(){try{let e;null!==s?.volume&&(e=s.volume),null!=(e=s.muted?0:e)&&i.setVolume(e)}catch(e){}}function u(e){e=e.getAd();console.log("Ad!",e,e?.isLinear()),m(),e.isLinear()||window.isAuthorized&&s.play()}console.log("Video Element",s,e),console.log("Initializing IMA",s),google?.ima?.AdDisplayContainer&&((n=document.getElementById("ad-container")).addEventListener("click",d),o=new google.ima.AdDisplayContainer(n,s),(t=new google.ima.AdsLoader(o)).addEventListener(google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,v,!1),t.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,E,!1),s.addEventListener("ended",function(){t.contentComplete()}),(e=new google.ima.AdsRequest).adTagUrl=vast,e.linearAdSlotWidth=s.clientWidth,e.linearAdSlotHeight=s.clientHeight,e.nonLinearAdSlotWidth=s.clientWidth,e.nonLinearAdSlotHeight=s.clientHeight/3,console.log("Running request for ads",e),t.requestAds(e)),s.addEventListener("play",function(e){if(!a){a=!0,e.preventDefault(),console.log("loading ads",s),s.load(),o?.initialize&&o.initialize();var e=s.clientWidth,n=s.clientHeight;try{i.init(e,n,google.ima.ViewMode.NORMAL),i.start(),console.log(i),window.imaPlaying=!0,m()}catch(e){console.log("AdsManager could not be started"),window.isAuthorized&&s.play()}}}),window.addEventListener("resize",function(e){console.log("window resized")}),window.addEventListener("resize",function(e){A()})};export{handleLoadIMA};