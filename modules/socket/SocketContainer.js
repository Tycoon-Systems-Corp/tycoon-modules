"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _index=require("../utility/socket/index"),_react=_interopRequireWildcard(require("react"));function _getRequireWildcardCache(e){var t,n;return"function"!=typeof WeakMap?null:(t=new WeakMap,n=new WeakMap,(_getRequireWildcardCache=function(e){return e?n:t})(e))}function _interopRequireWildcard(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=_typeof(e)&&"function"!=typeof e)return{default:e};t=_getRequireWildcardCache(t);if(t&&t.has(e))return t.get(e);var n,r,o={__proto__:null},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&((r=i?Object.getOwnPropertyDescriptor(e,n):null)&&(r.get||r.set)?Object.defineProperty(o,n,r):o[n]=e[n]);return o.default=e,t&&t.set(e,o),o}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){var n;if(e)return"string"==typeof e?_arrayLikeToArray(e,t):"Map"===(n="Object"===(n=Object.prototype.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:n)||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function _iterableToArrayLimit(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,c,l=[],u=!0,a=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=i.call(n)).done)&&(l.push(r.value),l.length!==t);u=!0);}catch(e){a=!0,o=e}finally{try{if(!u&&null!=n.return&&(c=n.return(),Object(c)!==c))return}finally{if(a)throw o}}return l}}function _arrayWithHoles(e){if(Array.isArray(e))return e}var SocketContainer=function(i){var c=i._socket,r=(0,_react.useRef)(!1),e=((0,_react.useRef)(null),_slicedToArray(_react.default.useState(null),2)),o=e[0],l=e[1],t=((0,_react.useEffect)(function(){!r.current&&i._loggedIn&&i.dborigin&&t()},[c,r.current,i._loggedIn,i.dborigin]),function(){return new Promise(function(e,t){c.connected&&i._loggedIn&&i.dborigin&&(0,_index.initialize)(c,i._loggedIn,i.dborigin),c.on("connect",function(e){console.log("Connected to socket ∞¦∞",c),r.current=!0,setTimeout(function(){(0,_index.initialize)(c,i._loggedIn,i.dborigin)},300)},{reconnectionAttempts:5}),c.on("disconnect",function(e){console.log("Disconnected from socket",c),o||"io server disconnect"===e&&(r.current=!1,e=setTimeout(function(){c.connect(),l(null)},5e3),l(e))}),c.on("connect_error",function(e){console.log("Connection failed",e),r.current=!1;e=setTimeout(function(){n(),l(null)},5e3);l(e)});var n=function(){setTimeout(function(){c.connect()},0<arguments.length&&void 0!==arguments[0]?arguments[0]:5e3)};return e()})});return(0,_react.useEffect)(function(){var e,t,n,r,o;if(c)return t=function(e){console.log(e)},n=function(e){i.setRooms&&(console.log("Rooms",e),i.setRooms(e)),setTimeout(function(){null!=e&&e.log&&i._LocalEventEmitter.dispatch("receive_chat",e.log)},250)},r=function(e){console.log("Receive",e),null!=e&&e.log&&i._LocalEventEmitter.dispatch("receive_chat",e.log)},o=function(e){console.log(e),null!=e&&e.tables&&i._LocalEventEmitter.dispatch("receive_ban_table",e.tables)},c.on("returnInitialize",e=function(e){console.log(e),i.setRooms&&i.setRooms(e)}),c.on("returnNotify",t),c.on("joinChat",n),c.on("receiveChat",r),c.on("receiveBanTable",o),function(){c.off("returnInitialize",e),c.off("returnNotify",t),c.off("joinChat",n),c.off("receiveChat",r),c.off("receiveBanTable",o)}},[i._loggedIn,i.setRooms]),_react.default.createElement("div",null)},_default=exports.default=SocketContainer;