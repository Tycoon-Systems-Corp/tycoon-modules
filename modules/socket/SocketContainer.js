import{initialize}from"../utility/socket/index";import React,{useRef,useEffect}from"react";const SocketContainer=l=>{const d=l["_socket"];let n=useRef(!1);useRef(null);const[i,c]=React.useState(null),e=(useEffect(()=>{!n.current&&l._loggedIn&&l.dborigin&&e()},[d,n.current,l._loggedIn,l.dborigin]),()=>new Promise((e,o)=>{d.connected&&l._loggedIn&&l.dborigin&&initialize(d,l._loggedIn,l.dborigin),d.on("connect",e=>{console.log("Connected to socket ∞¦∞",d),n.current=!0,setTimeout(()=>{initialize(d,l._loggedIn,l.dborigin)},300)},{reconnectionAttempts:5}),d.on("disconnect",e=>{console.log("Disconnected from socket",d),i||"io server disconnect"===e&&(n.current=!1,e=setTimeout(()=>{d.connect(),c(null)},5e3),c(e))}),d.on("connect_error",e=>{console.log("Connection failed",e),n.current=!1;e=setTimeout(()=>{t(),c(null)},5e3);c(e)});let t=(e=5e3)=>{setTimeout(()=>{d.connect()},e)};return e()}));return useEffect(()=>{if(d){const e=e=>{console.log(e),l.setRooms&&l.setRooms(e)},o=e=>{console.log(e)},t=e=>{l._LocalEventEmitter.dispatch("uploadUpdate",e)},n=e=>{l._LocalEventEmitter.dispatch("uploadProgressUpdate",e)},i=e=>{l.setRooms&&(console.log("Rooms",e),l.setRooms(e)),setTimeout(()=>{e?.log&&l._LocalEventEmitter.dispatch("receive_chat",e.log)},250)},c=e=>{console.log("Receive",e),e?.log&&l._LocalEventEmitter.dispatch("receive_chat",e.log)},r=e=>{console.log(e),e?.tables&&l._LocalEventEmitter.dispatch("receive_ban_table",e.tables)},s=e=>{e&&l._LocalEventEmitter.dispatch("scraper_updates",e)},a=e=>{e&&l._LocalEventEmitter.dispatch("incoming_authorization_ask",e)};return d.on("returnInitialize",e),d.on("returnNotify",o),d.on("joinChat",i),d.on("receiveChat",c),d.on("receiveBanTable",r),d.on("scraperUpdates",s),d.on("uploadUpdate",t),d.on("uploadProgressUpdate",n),d.on("incomingAuthorizationAsk",a),()=>{d.off("returnInitialize",e),d.off("returnNotify",o),d.off("joinChat",i),d.off("receiveChat",c),d.off("receiveBanTable",r),d.off("scraperUpdates",s),d.off("uploadUpdate",t),d.off("uploadProgressUpdate",n),d.off("incomingAuthorizationAsk",a)}}},[l._loggedIn,l.setRooms]),React.createElement("div",null)};export default SocketContainer;