"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _react=_interopRequireDefault(require("react")),_SurveyModule=_interopRequireDefault(require("./Survey.module.scss")),_reactTextareaAutosize=_interopRequireDefault(require("react-textarea-autosize")),_mail=require("../utility/mail"),_product=require("../ecommerce/product"),_util=require("../util"),_ecommerce=require("../utility/ecommerce"),_defaults=require("../ecommerce/product/defaults"),_Functions=require("../ecommerce/shop/Functions"),_uuid=require("uuid");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _extends(){return(_extends=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n,r=arguments[t];for(n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function ownKeys(t,e){var n,r=Object.keys(t);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(t),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)),r}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(n),!0).forEach(function(e){_defineProperty(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function _defineProperty(e,t,n){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"==_typeof(e)?e:String(e)}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0===n)return("string"===t?String:Number)(e);n=n.call(e,t||"default");if("object"!=_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}function _regeneratorRuntime(){_regeneratorRuntime=function(){return a};var i,a={},e=Object.prototype,c=e.hasOwnProperty,s=Object.defineProperty||function(e,t,n){e[t]=n.value},t="function"==typeof Symbol?Symbol:{},r=t.iterator||"@@iterator",n=t.asyncIterator||"@@asyncIterator",l=t.toStringTag||"@@toStringTag";function u(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(i){u=function(e,t,n){return e[t]=n}}function o(e,t,n,r){var l,u,a,o,t=t&&t.prototype instanceof g?t:g,t=Object.create(t.prototype),r=new O(r||[]);return s(t,"_invoke",{value:(l=e,u=n,a=r,o=f,function(e,t){if(o===v)throw new Error("Generator is already running");if(o===y){if("throw"===e)throw t;return{value:i,done:!0}}for(a.method=e,a.arg=t;;){var n=a.delegate;if(n){n=function e(t,n){var r=n.method,l=t.iterator[r];if(l===i)return n.delegate=null,"throw"===r&&t.iterator.return&&(n.method="return",n.arg=i,e(t,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),m;r=d(l,t.iterator,n.arg);if("throw"===r.type)return n.method="throw",n.arg=r.arg,n.delegate=null,m;l=r.arg;return l?l.done?(n[t.resultName]=l.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=i),n.delegate=null,m):l:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,m)}(n,a);if(n){if(n===m)continue;return n}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if(o===f)throw o=y,a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);o=v;n=d(l,u,a);if("normal"===n.type){if(o=a.done?y:p,n.arg===m)continue;return{value:n.arg,done:a.done}}"throw"===n.type&&(o=y,a.method="throw",a.arg=n.arg)}})}),t}function d(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}a.wrap=o;var f="suspendedStart",p="suspendedYield",v="executing",y="completed",m={};function g(){}function h(){}function _(){}var t={},b=(u(t,r,function(){return this}),Object.getPrototypeOf),b=b&&b(b(x([]))),S=(b&&b!==e&&c.call(b,r)&&(t=b),_.prototype=g.prototype=Object.create(t));function T(e){["next","throw","return"].forEach(function(t){u(e,t,function(e){return this._invoke(t,e)})})}function w(a,o){var t;s(this,"_invoke",{value:function(n,r){function e(){return new o(function(e,t){!function t(e,n,r,l){var u,e=d(a[e],a,n);if("throw"!==e.type)return(n=(u=e.arg).value)&&"object"==_typeof(n)&&c.call(n,"__await")?o.resolve(n.__await).then(function(e){t("next",e,r,l)},function(e){t("throw",e,r,l)}):o.resolve(n).then(function(e){u.value=e,r(u)},function(e){return t("throw",e,r,l)});l(e.arg)}(n,r,e,t)})}return t=t?t.then(e,e):e()}})}function E(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function A(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function O(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(E,this),this.reset(!0)}function x(t){if(t||""===t){var n,e=t[r];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length))return n=-1,(e=function e(){for(;++n<t.length;)if(c.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=i,e.done=!0,e}).next=e}throw new TypeError(_typeof(t)+" is not iterable")}return s(S,"constructor",{value:h.prototype=_,configurable:!0}),s(_,"constructor",{value:h,configurable:!0}),h.displayName=u(_,l,"GeneratorFunction"),a.isGeneratorFunction=function(e){e="function"==typeof e&&e.constructor;return!!e&&(e===h||"GeneratorFunction"===(e.displayName||e.name))},a.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,_):(e.__proto__=_,u(e,l,"GeneratorFunction")),e.prototype=Object.create(S),e},a.awrap=function(e){return{__await:e}},T(w.prototype),u(w.prototype,n,function(){return this}),a.AsyncIterator=w,a.async=function(e,t,n,r,l){void 0===l&&(l=Promise);var u=new w(o(e,t,n,r),l);return a.isGeneratorFunction(t)?u:u.next().then(function(e){return e.done?e.value:u.next()})},T(S),u(S,l,"Generator"),u(S,r,function(){return this}),u(S,"toString",function(){return"[object Generator]"}),a.keys=function(e){var t,n=Object(e),r=[];for(t in n)r.push(t);return r.reverse(),function e(){for(;r.length;){var t=r.pop();if(t in n)return e.value=t,e.done=!1,e}return e.done=!0,e}},a.values=x,O.prototype={constructor:O,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=i,this.done=!1,this.delegate=null,this.method="next",this.arg=i,this.tryEntries.forEach(A),!e)for(var t in this)"t"===t.charAt(0)&&c.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=i)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(n){if(this.done)throw n;var r=this;function e(e,t){return u.type="throw",u.arg=n,r.next=e,t&&(r.method="next",r.arg=i),!!t}for(var t=this.tryEntries.length-1;0<=t;--t){var l=this.tryEntries[t],u=l.completion;if("root"===l.tryLoc)return e("end");if(l.tryLoc<=this.prev){var a=c.call(l,"catchLoc"),o=c.call(l,"finallyLoc");if(a&&o){if(this.prev<l.catchLoc)return e(l.catchLoc,!0);if(this.prev<l.finallyLoc)return e(l.finallyLoc)}else if(a){if(this.prev<l.catchLoc)return e(l.catchLoc,!0)}else{if(!o)throw new Error("try statement without catch or finally");if(this.prev<l.finallyLoc)return e(l.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;0<=n;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&c.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var l=r;break}}var u=(l=l&&("break"===e||"continue"===e)&&l.tryLoc<=t&&t<=l.finallyLoc?null:l)?l.completion:{};return u.type=e,u.arg=t,l?(this.method="next",this.next=l.finallyLoc,m):this.complete(u)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),m},finish:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),A(n),m}},catch:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var n,r,l=this.tryEntries[t];if(l.tryLoc===e)return"throw"===(n=l.completion).type&&(r=n.arg,A(l)),r}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:x(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=i),m}},a}function asyncGeneratorStep(e,t,n,r,l,u,a){try{var o=e[u](a),i=o.value}catch(e){return void n(e)}o.done?t(i):Promise.resolve(i).then(r,l)}function _asyncToGenerator(o){return function(){var e=this,a=arguments;return new Promise(function(t,n){var r=o.apply(e,a);function l(e){asyncGeneratorStep(r,t,n,l,u,"next",e)}function u(e){asyncGeneratorStep(r,t,n,l,u,"throw",e)}l(void 0)})}}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){var n;if(e)return"string"==typeof e?_arrayLikeToArray(e,t):"Map"===(n="Object"===(n=Object.prototype.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:n)||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function _iterableToArrayLimit(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,l,u,a,o=[],i=!0,c=!1;try{if(u=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;i=!1}else for(;!(i=(r=u.call(n)).done)&&(o.push(r.value),o.length!==t);i=!0);}catch(e){c=!0,l=e}finally{try{if(!i&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw l}}return o}}function _arrayWithHoles(e){if(Array.isArray(e))return e}var Module=function(a){function i(e){var t;a.setSurveyState&&a.surveyState&&((t=a.surveyState).answers=e,a.setSurveyState(t)),G(e)}function c(e){var t;a.setSurveyState&&a.surveyState&&((t=a.surveyState).currentStage=e,a.setSurveyState(t)),F(e),null!=I&&I.stages&&I.stages[e]&&"function"==typeof(null==(t=I.stages[e])?void 0:t.func)&&I.stages[e].func()}function r(e){var t;a.setSurveyState&&a.surveyState&&((t=a.surveyState).pipelineDbItem=e,a.setSurveyState(t)),V(e)}function s(e){if(console.log("Do Clear",e),e)for(var t,n=0;n<e.length;n++)console.log(null==(t=e[n])?void 0:t.getAttribute("surveyclear")),null!=(t=e[n])&&t.getAttribute("surveyclear")&&(e[n].value="",console.log(e[n]),e[n].getAttribute("usedefault"))&&(e[n].value=e[n].getAttribute("usedefault"))}function d(e,t){var n=_objectSpread({},b),r=(n[e]=t,console.log("Temp",n),v);r[p]||(r[p]={}),r[p].pipeline||(r[p].pipeline={}),r[p].pipeline[e]=t,i(r),e=n,a.setSurveyState&&a.surveyState&&((t=a.surveyState).pipelineObject=e,a.setSurveyState(t)),W(e)}function M(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"lineup",n=2<arguments.length?arguments[2]:void 0,r=E,l=O;e&&(e.forEach(function(e){r.append("image",e),l.push({name:e.name,modif:t,id:n})}),r.append("imgNames",JSON.stringify(l))),A(r),Q(l),null!=a&&a.setImgCache&&a.setImgCache(r),a.setSurveyState&&a.surveyState&&((e=a.surveyState).imgFor=l,a.setSurveyState(e))}function o(e){var t;if(null!=e&&e.component&&"function"==typeof e.component)return t=e.component,_react.default.createElement(t,_extends({},a,{m:e}))}function e(t,e,n,r,l,u){return _react.default.createElement("div",{className:"".concat(_SurveyModule.default[n]," ").concat(_SurveyModule.default.item," ").concat(H&&r?"".concat(_SurveyModule.default[r]):null," ").concat(z&&e?"".concat(_SurveyModule.default[e]):null," ").concat(U&&l?"".concat(_SurveyModule.default.keepCurrent," ").concat(_SurveyModule.default.backToOriginal):null," ").concat(null==t?void 0:t.className," survey_itemContainer"),style:{background:null!=(n=null==t?void 0:t.bg)?n:null,color:null!=(r=null==t?void 0:t.color)?r:null}},_react.default.createElement("h1",{className:"".concat(_SurveyModule.default.title," survey_title")},null==t?void 0:t.label),"select"===(null==t||null==(e=t.input)?void 0:e.type)?_react.default.createElement("ul",{className:_SurveyModule.default.survey__optionsList},null==t||null==(l=t.input)?void 0:l.options.map(function(e){return _react.default.createElement("li",{key:e.label},_react.default.createElement("button",{className:_SurveyModule.default.survey__optionButton,onClick:X,goto:e.goto,label:e.label,question:null==t?void 0:t.label,value:e.label},e.label))})):"number"===(null==t||null==(n=t.input)?void 0:n.type)?_react.default.createElement("div",null,_react.default.createElement("input",{type:"number",className:"".concat(_SurveyModule.default.numberInput),defaultValue:null==t||null==(r=t.input)?void 0:r.default,ref:N})):"text"===(null==t||null==(e=t.input)?void 0:e.type)?_react.default.createElement("div",null,_react.default.createElement(_reactTextareaAutosize.default,{type:"text",className:"".concat(_SurveyModule.default.textInput),placeholder:null==t||null==(l=t.input)?void 0:l.default,minRows:3,ref:N,onKeyDown:D,goto:null==t||null==(n=t.confirm)?void 0:n.goto,question:null==t?void 0:t.label,defaultValue:null==(r=v[u])?void 0:r.answer})):null!=t&&t.component&&"function"==typeof t.component?_react.default.createElement("div",null,o(t)):null,null!=t&&null!=(e=t.pipeline)&&e.map?t.pipeline.map(function(e,t){return _react.default.createElement("div",{key:t,className:"survey_pipelineItemContainer",style:{marginBottom:".25rem"}},_react.default.createElement("label",{style:{lineHeight:"1.5rem"}},null!=(t=null==e?void 0:e.label)?t:""),_react.default.createElement("div",null,"text"===(null==e||null==(t=e.input)?void 0:t.type)?_react.default.createElement("div",{className:"".concat(null==e?void 0:e.className)},_react.default.createElement(_reactTextareaAutosize.default,{type:"text",className:"".concat(_SurveyModule.default.textInput),placeholder:null==e||null==(t=e.input)?void 0:t.default,onInput:D,var:null==e||null==(t=e.input)?void 0:t.var,pipeline:"true",minRows:null!=(t=null==e||null==(t=e.input)?void 0:t.rows)?t:1,usedefault:b[null==e||null==(t=e.input)?void 0:t.var],surveyclear:"true"})):"datetime-local"===(null==e||null==(t=e.input)?void 0:t.type)?_react.default.createElement("div",{className:"".concat(null==e?void 0:e.className)},_react.default.createElement("input",{type:"datetime-local",placeholder:null==e||null==(t=e.input)?void 0:t.default,onInput:D,var:null==e||null==(t=e.input)?void 0:t.var,pipeline:"true",surveyclear:"true",usedefault:b[null==e||null==(t=e.input)?void 0:t.var]})):"lineup"===(null==e||null==(t=e.input)?void 0:t.type)?_react.default.createElement("div",{className:"".concat(null==e?void 0:e.className)},_react.default.createElement(_product.Lineup,_extends({},a,{product:S,editing:S,editingOptionsMeta:null!=(t=null==S?void 0:S.detailmeta)?t:null,setOptionsMetaData:ne,currentLineupEditing:$,setCurrentLineupEditing:J,appendFormData:M}))):"price"===(null==e||null==(t=e.input)?void 0:t.type)?_react.default.createElement("div",{className:"".concat(null==e?void 0:e.className," flex gap-p2")},_react.default.createElement("span",null,"$"),_react.default.createElement("span",null,_react.default.createElement("input",{type:"text",style:{width:"100%"},onChange:re,var:null==e||null==(t=e.input)?void 0:t.var,pipeline:"true",surveyclear:"true",method:null==e||null==(t=e.input)?void 0:t.method,usedefault:!(0,_util.isObjectEmpty)(b)&&Object.prototype.hasOwnProperty.call(b,[null==e||null==(t=e.input)?void 0:t.var])&&null!==b[null==e||null==(t=e.input)?void 0:t.var]?_ecommerce.westernMoneyFormat.format(b[null==e||null==(t=e.input)?void 0:t.var]):"10.00"}))):"quantity"===(null==e||null==(t=e.input)?void 0:t.type)?_react.default.createElement("div",{className:"".concat(null==e?void 0:e.className," flex gap-p2")},_react.default.createElement("span",null,"Qty"),_react.default.createElement("span",null,_react.default.createElement("input",{type:"text",style:{width:"100%"},onChange:le,var:null==e||null==(t=e.input)?void 0:t.var,pipeline:"true",surveyclear:"true",method:null==e||null==(t=e.input)?void 0:t.method,usedefault:!(0,_util.isObjectEmpty)(b)&&Object.prototype.hasOwnProperty.call(b,[null==e||null==(t=e.input)?void 0:t.var])&&null!==b[null==e||null==(t=e.input)?void 0:t.var]?b[null==e||null==(t=e.input)?void 0:t.var]:"100"}))):"image"===(null==e||null==(t=e.input)?void 0:t.type)&&-1<["leadImg","featureImg"].indexOf(null==e||null==(t=e.input)?void 0:t.var)?_react.default.createElement("div",{className:"".concat(null==e?void 0:e.className)},_react.default.createElement("div",{style:{height:null!=(t=null==e?void 0:e.height)?t:"200px",width:null!=(t=null==e?void 0:e.width)?t:"200px"}},function(e){for(var n,t,r=0;r<O.length;r++)(null==e||null==(t=e.input)?void 0:t.var)===O[r].modif&&(n=O[r].name);_toConsumableArray(E.entries()).filter(function(e){var e=_slicedToArray(e,2),t=e[0];e[1];return"image"===t}).forEach(function(e,t){e=_slicedToArray(e,2),e[0],e=e[1];n===e.name&&(l=e)}),l&&oe(l,e.input.var);var l,u="".concat("featureImg"===e.input.var&&ie?"".concat(null==a||null==(u=a.cdn)?void 0:u.static,"/").concat(ie):"leadImg"===e.input.var&&ce?"".concat(null==a||null==(u=a.cdn)?void 0:u.static,"/").concat(ce):"img/default/greythumb.jpg");return _react.default.createElement("img",{style:{backgroundImage:"url(".concat(u,")"),backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat",width:"100%",height:"100%"},selectimg:null==e||null==(u=e.input)?void 0:u.var})}(e)),_react.default.createElement("div",{className:"flex gap-p2 ".concat(_SurveyModule.default.pseudoButton),style:{alignItems:"center",fontSize:".8rem",marginTop:".5rem"},onClick:ae,modif:null==e||null==(t=e.input)?void 0:t.var},_react.default.createElement("div",{className:"material-icons",style:{alignSelf:"center"}},"add"),_react.default.createElement("div",null,null==e?void 0:e.note)),_react.default.createElement("input",{style:{display:"none"},type:"file",onChange:ue,selectmodif:e.input.var})):null!=e&&e.component?_react.default.createElement("div",null,o(e)):null))}):null,_react.default.createElement("div",{className:"survey_errorContainer"},_react.default.createElement("div",{className:"error",ref:k,style:{opacity:0}},x[u])),_react.default.createElement("div",{className:"flex survey_confirmBackButtonContainer",style:{marginTop:".5rem",justifyContent:"space-between"}},_react.default.createElement("button",{className:"".concat(_SurveyModule.default.confirmButton," survey_confirmButton"),onClick:Z,goto:null==t||null==(l=t.confirm)?void 0:l.goto,label:null==t?void 0:t.label,value:"confirm",question:null==t?void 0:t.label,style:{opacity:null!=t&&t.confirm?1:0,transition:0}},null!=t&&null!=(n=t.confirm)&&n.label?null==t?void 0:t.confirm.label:"end"===(null==t||null==(r=t.confirm)?void 0:r.goto)?"Confirm":"Next"),!(f&&0<f.length)||null!=t&&t.submit||T?null:_react.default.createElement("button",{onClick:te,className:"".concat(_SurveyModule.default.backButton," survey_backButton"),style:{transition:0}},"Back")))}var t=_slicedToArray(_react.default.useState(!1),2),n=t[0],q=t[1],t=_slicedToArray(_react.default.useState(!1),2),l=t[0],R=t[1],t=_slicedToArray(_react.default.useState([]),2),f=t[0],B=t[1],t=_slicedToArray(_react.default.useState(null),2),p=t[0],F=t[1],t=_slicedToArray(_react.default.useState({}),2),v=t[0],G=t[1],t=_slicedToArray(_react.default.useState(null),2),u=t[0],y=t[1],t=_slicedToArray(_react.default.useState(null),2),m=t[0],g=t[1],t=_slicedToArray(_react.default.useState(null),2),H=t[0],h=t[1],t=_slicedToArray(_react.default.useState(null),2),z=t[0],K=t[1],t=_slicedToArray(_react.default.useState(!1),2),U=t[0],_=t[1],t=_slicedToArray(_react.default.useState({}),2),b=t[0],W=t[1],t=_slicedToArray(_react.default.useState({}),2),S=t[0],V=t[1],t=_slicedToArray(_react.default.useState(!1),2),T=t[0],Y=t[1],t=_slicedToArray(_react.default.useState(0),2),$=t[0],J=t[1],t=_slicedToArray(_react.default.useState(_defaults.defaultDefinePriceCurrency),2),w=t[0],t=(t[1],_slicedToArray(_react.default.useState(new FormData),2)),E=t[0],A=t[1],t=_slicedToArray(_react.default.useState([]),2),O=t[0],Q=t[1],t=_slicedToArray(_react.default.useState({}),2),x=t[0],j=t[1],N=_react.default.useRef(),k=_react.default.useRef(),I=a.survey,L=null==I?void 0:I.stages[p],P=null==I?void 0:I.stages[u],t=null==I?void 0:I.stages[m],Z=(_react.default.useEffect(function(){n||(null!=a&&a.imgCache&&A(a.imgCache),q(!0))},[n,null==a?void 0:a.imgCache]),_react.default.useEffect(function(){var e;!p&&null!=I&&null!=(e=I.stages)&&e.index&&c("index")},[I,p]),_react.default.useEffect(function(){var e;null!=I&&I.pipelineDbItemDefault&&!(0,_util.isObjectEmpty)(I.pipelineDbItemDefault)&&(0,_util.isObjectEmpty)(S)?r(I.pipelineDbItemDefault):(0,_util.isObjectEmpty)(S)&&null!=a&&null!=(e=a.surveyState)&&e.pipelineDbItem&&!(0,_util.isObjectEmpty)(null==a||null==(e=a.surveyState)?void 0:e.pipelineDbItem)&&r(a.pipelineDbItem)},[S,null==I?void 0:I.pipelineDbItemDefault]),_react.default.useCallback(function(e){var t,n=null==e||null==(n=e.currentTarget)?void 0:n.getAttribute("goto"),r=null==e||null==(r=e.currentTarget)?void 0:r.getAttribute("question"),e=null!=(t=null!=(t=null==N||null==(t=N.current)?void 0:t.value)?t:null==e||null==(t=e.current)?void 0:t.value)?t:null==e||null==(t=e.currentTarget)?void 0:t.value;C(n,r,e)})),X=_react.default.useCallback(function(e){var t=null==e||null==(t=e.currentTarget)?void 0:t.getAttribute("goto"),n=null==e||null==(n=e.currentTarget)?void 0:n.getAttribute("question"),r=null!=(r=null==e||null==(r=e.currentTarget)?void 0:r.getAttribute("value"))?r:e.currentTarget.value;C(t,n,r)}),C=function(t,n,r){if(console.log(L),j({}),null!=k&&k.current&&(k.current.innerHTML="",k.current.style.opacity=0),null!=L&&L.validation&&"function"==typeof L.validation){var e,l=L.validation(L,r);if(console.log(l),l)return(e=x)[p]=l,j(e),null!=k&&k.current&&(k.current.innerHTML=l,k.current.style.opacity=1),null}if(null!=L&&null!=(e=L.pipeline)&&e.length)for(var u=0;u<L.pipeline.length;u++)if(null!=(o=L.pipeline[u])&&o.input&&null!=(o=L.pipeline[u])&&null!=(o=o.input)&&o.validation&&"function"==typeof L.pipeline[u].input.validation){var a,o=null==(o=L.pipeline[u])||null==(o=o.input)?void 0:o.validation(L.pipeline[u],b[L.pipeline[u].input.var]);if(o)return console.log(o),(a=x)[p]=o,j(a),null!=k&&k.current&&(k.current.innerHTML=o,k.current.style.opacity=1),null}y(t),g(p),setTimeout(function(){h(!0)},100),null!=N&&N.current&&(N.current.value="",N.current.placeholder="",N.current.select()),setTimeout(function(){var e;_(!0),t&&(console.log(n),n&&((e=v)[p]||(e[p]={}),e[p].question=n,e[p].answer=r,i(e)),null!=I&&null!=(e=I.stages[t])&&e.input&&null!=N&&N.current&&(Object.prototype.hasOwnProperty.call(null==I?void 0:I.stages[t].input,"default")&&(N.current.value=I.stages[t].input.default),Object.prototype.hasOwnProperty.call(null==I?void 0:I.stages[t].input,"placeholder"))&&(N.current.placeholder=I.stages[t].input.placeholder),c(t),setTimeout(function(){s(document.getElementsByTagName("textarea")),s(document.getElementsByTagName("input"))},100)),setTimeout(function(){y(null),h(null),_(!1)},100)},450),ee(p,!0)},ee=function(e,t){var n=f;t&&e?n.push(e):n.pop(),B(n)},te=_react.default.useCallback(function(e){var t;0<f.length&&(t=f[f.length-1],console.log(t),g(t),setTimeout(function(){K(!0)},100),setTimeout(function(){var e;_(!0),t&&(c(t),setTimeout(function(){s(document.getElementsByTagName("textarea")),s(document.getElementsByTagName("input"))},1)),setTimeout(function(){g(null),K(null),_(!1)},100),null!=I&&null!=(e=I.stages[t])&&e.input&&null!=N&&N.current&&(Object.prototype.hasOwnProperty.call(null==I?void 0:I.stages[t].input,"default")&&(N.current.value=I.stages[t].input.default),Object.prototype.hasOwnProperty.call(null==I?void 0:I.stages[t].input,"placeholder"))&&(N.current.placeholder=I.stages[t].input.placeholder)},450),ee(null,!1))}),D=(_react.default.useEffect(function(){l||null!=N&&N.current&&null!=L&&L.input&&(console.log("Running"),R(!0),N.current.value="",N.current.placeholder="",N.current.select(),Object.prototype.hasOwnProperty.call(L.input,"default")&&(N.current.value=L.input.default),Object.prototype.hasOwnProperty.call(L.input,"placeholder"))&&(N.current.placeholder=L.input.placeholder)},[l,L]),_react.default.useEffect(function(){console.log(L,T),(null!=L&&L.submit||null!=P&&P.submit)&&!T&&(function(){var t=_asyncToGenerator(_regeneratorRuntime().mark(function e(t){var n;return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t)return e.next=3,(0,_mail.sendSurveyEmail)(a.apiUrl,a.domainKey,t,I.name,a._loggedIn);e.next=5;break;case 3:n=e.sent,console.log(n);case 5:case"end":return e.stop()}},e)}));return function(e){return t.apply(this,arguments)}}()(v),Y(!0))},[L,T]),_react.default.useCallback(function(e){try{var t,n,r,l,u,a,o,i,c,s;e&&(u=null!=(t=null==e||null==(n=e.current)?void 0:n.value)?t:null==e||null==(r=e.currentTarget)?void 0:r.value,null!=e&&null!=(l=e.currentTarget)&&l.getAttribute("pipeline")?(console.log(u,"Add to Obj"),d(null==e||null==(a=e.currentTarget)?void 0:a.getAttribute("var"),u)):13===e.keyCode&&(e.preventDefault(),c=null==e||null==(o=e.currentTarget)?void 0:o.getAttribute("goto"),s=null==e||null==(i=e.currentTarget)?void 0:i.getAttribute("question"),console.log(u,s,c),C(c,s,u)))}catch(e){console.log(e)}})),ne=_react.default.useCallback(function(e){console.log(e.currentTarget.checked,e.currentTarget.getAttribute("option")),(0,_Functions.doSetOptionsMetaData)(e,null==S?void 0:S.detailmeta,S,r,null,$,J)}),re=_react.default.useCallback(function(e){var t,n;e.currentTarget&&(null!=e&&null!=(n=e.currentTarget)&&n.getAttribute("pipeline")&&(n=null!=(n=null==e||null==(n=e.current)?void 0:n.value)?n:null==e||null==(n=e.currentTarget)?void 0:n.value,console.log(n,"Add to Obj"),d(null==e||null==(t=e.currentTarget)?void 0:t.getAttribute("var"),n)),t=_objectSpread({},S),"singleStyle"===(null==e||null==(n=e.currentTarget)?void 0:n.getAttribute("method")))&&(n=null!=t&&t.styles[0]?0:-1,console.log(n,e.currentTarget.value,!isNaN(Number(e.currentTarget.value))),-1<n)&&(isNaN(Number(e.currentTarget.value))||("USD"===(null==w?void 0:w.currency)?t.styles[n].price=Number(e.currentTarget.value):(t.styles[n].priceTable||(t.styles[n].priceTable={}),t.styles[n].priceTable[w.currency]=Number(e.currentTarget.value)),r(t)))}),le=_react.default.useCallback(function(e){var t,n;e.currentTarget&&(null!=e&&null!=(n=e.currentTarget)&&n.getAttribute("pipeline")&&(n=null!=(n=null==e||null==(n=e.current)?void 0:n.value)?n:null==e||null==(n=e.currentTarget)?void 0:n.value,console.log(n,"Add to Obj"),d(null==e||null==(t=e.currentTarget)?void 0:t.getAttribute("var"),n)),t=_objectSpread({},S),"singleStyle"===(null==e||null==(n=e.currentTarget)?void 0:n.getAttribute("method")))&&-1<(n=null!=t&&t.styles[0]?0:-1)&&(isNaN(Number(e.currentTarget.value))||(t.styles[n].option[0].quantity=Number(e.currentTarget.value)),r(t))}),ue=_react.default.useCallback(function(e){console.log(e,"Handle New");var n=null==e||null==(t=e.currentTarget)?void 0:t.getAttribute("selectmodif"),e=(console.log("Sel",n),console.log(E),null==e||null==(t=e.target)?void 0:t.files),t=Array.from(e).slice(0,1<e.length?1:e.length).filter(function(e){return e.type&&-1<_defaults.allowedTypes.indexOf(e.type)}).map(function(e){var t=e.slice(0,e.size,e.type),n=_defaults.allowedTypes[_defaults.allowedTypes.indexOf(e.type)].match(/\/([a-zA-Z0-9].*)/)[1];return new File([t],"".concat((0,_uuid.v4)(),".").concat(n),{type:e.type})}),r=(console.log("Files Renamed",t,E),E),l=O;t&&t.forEach(function(t){r.append("image",t),oe(t,n);var e=l.findIndex(function(e){return e.name===t.name});-1<e&&l.splice(e,1),l.push({name:t.name,modif:n})}),Q(l),A(r),null!=a&&a.setImgCache&&a.setImgCache(r),a.setSurveyState&&a.surveyState&&((e=a.surveyState).imgFor=l,a.setSurveyState(e))}),ae=_react.default.useCallback(function(e){var t;console.log(e,"Add Temp"),null!=e&&null!=(t=e.currentTarget)&&t.getAttribute("modif")&&null!=(e=document.querySelector("input[selectmodif='".concat(null==e||null==(t=e.currentTarget)?void 0:t.getAttribute("modif"),"']")))&&e.click&&e.click()}),oe=function(r,l){return new Promise(function(e,t){var n=new FileReader;n.onload=function(){console.log(n.result),document.querySelector("img[selectimg=".concat(l,"]")).style.backgroundImage="url(".concat(n.result,")"),e(n.result)},n.onerror=function(){t(n.error)},n.readAsDataURL(r)})},ie=null!=S&&S.images?S.images.find(function(e){return null==e?void 0:e.bgImg}):null,ce=S.images?S.images.find(function(e){return null==e?void 0:e.leadImg}):null;return console.log(p,v,f,u,T,a,L),console.log("Pipeline Object",b,S,m,u),_react.default.createElement("div",{className:_SurveyModule.default.survey__container,style:{height:null!=a&&a.height?"".concat(a.height,"px"):"100vh"}},m?e(t,"animatingBackBack","backItem",null,null,m):null,e(L,"animatingBackCurrent","currentItem","animatingNextCurrent",!0,p),u?e(P,null,"nextItem","animatingNextNext",null,u):null)},_default=exports.default=Module;