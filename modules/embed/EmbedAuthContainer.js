function _extends(){return(_extends=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n,o=arguments[t];for(n in o)Object.prototype.hasOwnProperty.call(o,n)&&(e[n]=o[n])}return e}).apply(this,arguments)}import React from"react";import{useRouter}from"next/router";import{v4 as uuidv4}from"uuid";import{checkSignedIn}from"/modules/utility/onboarding";import{fetchPost}from"/modules/utility/fetch";import{SignIn,Username}from"/modules/onboarding/signin";const Module=a=>{const t=useRouter(),[n,o]=React.useState(!1),[e,s]=React.useState(null);let[i,c]=React.useState(!1);const[r,l]=React.useState(!1),[,u]=React.useState(!1),[d,g]=React.useState(null),m=(a._LocalEventEmitter.unsubscribe(e),a._LocalEventEmitter.subscribe(e,e=>{e&&"loadDefault"===e.dispatch&&m()}),React.useEffect(()=>{if(!n){const t=uuidv4();s(t),o(!0),f(250);var e=setInterval(()=>{a._LocalEventEmitter.dispatch(t,{dispatch:"loadDefault"})},2500);g(e)}},[n]),React.useEffect(()=>{a?._loggedIn?.identifier&&!r&&d&&m()},[a?._loggedIn?.identifier,r,d]),async()=>{d&&clearInterval(d),l(!0),u(!0);var e={hash:a._loggedIn.hash,identifier:a._loggedIn.identifier,customer:t?.query?.cus},e=await fetchPost(a.apiUrl+"/a/checkexistingcustomer",null,null,e);return u(!1),!!e&&(e.hasOwnProperty("status")?"disauthenticated"==e.status?(logout(),"disauthenticated"):"failed"==e.status?(a?.setAdminAuth&&a.setAdminAuth({}),!1):"success"==e.status?(a?.setAdminAuth&&e?.data&&a.setAdminAuth({data:e.data,user:e.user}),e):void 0:void 0)}),f=(e,t,n=0)=>{try{if(console.log("Trying load",e,n),!i||t){const o={theme:"outline",size:"medium",logo_alignment:"center"};setTimeout(()=>{try{var e=checkSignedIn();e?a._setLoggedIn(e):(google.accounts.id.renderButton(googleSignIn.current,o),c(!0),google.accounts.id.prompt(e=>{console.log("on prompt notification",e)}))}catch(e){setTimeout(()=>{try{var e=checkSignedIn();e?a._setLoggedIn(e):(google.accounts.id.renderButton(googleSignIn.current,o),c(!0),google.accounts.id.prompt(e=>{console.log("on prompt notification",e)}))}catch(e){console.log(e)}},1e4)}},e)}else n<5&&setTimeout(()=>{f(e,t,n+1)},e)}catch(e){console.log(e)}};return React.createElement("div",{className:""+(a.className??"")},React.createElement("style",null,`

                `),React.createElement("div",{className:"simpleCenter"},a?._loggedIn?a._loggedIn&&!a._loggedIn?.username?React.createElement(Username,a):null:React.createElement(SignIn,_extends({},a,{googleSignInRendered:i}))))};export default Module;