function _extends(){return(_extends=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a,l=arguments[t];for(a in l)Object.prototype.hasOwnProperty.call(l,a)&&(e[a]=l[a])}return e}).apply(this,arguments)}import React from"react";import{useRouter}from"next/router";import{v4 as uuidv4}from"uuid";import{LoadForums,ThreadPage}from"/modules/comment/forum";import apiReq from"/modules/utility/api/apiReq";import{AddComment}from"/modules/comment/parts";import{submitPost}from"/modules/utility/utility/comment";import middlewareFunctions from"/customModules/middleware/MiddlewareFunctions";const Module=c=>{const{query:a,asPath:l}=useRouter(),[t,n]=React.useState(!1),[,r]=React.useState(null),[i,o]=React.useState(null),[e,u]=React.useState(!1),[d,s]=React.useState([]),[m,R]=React.useState(0),[,g]=React.useState(null),[p,f]=React.useState(null),[h,v]=React.useState(!0),y=(React.useEffect(()=>{var e;t||(e=uuidv4(),r(e),E(),n(!0))},[t]),React.useEffect(()=>{y()},[c._loggedIn?.identifier,c._loggedIn?.hash,h,p]),async()=>{if(!await middlewareFunctions.manualAllowResourceAuth(c,l,a))if(c?._loggedIn?.identifier&&c?._loggedIn?.hash){let e=!1;g(c._loggedIn.identifier);var t=p,t=(t?.identifier!==c._loggedIn.identifier&&t&&t?.hash!==c._loggedIn.hash&&Object.prototype.hasOwnProperty.call(t,"auth")&&(t.auth=!1),await middlewareFunctions.manualAllowResourceAuth(c,l,a,c._loggedIn.identifier,t));f({identifier:c._loggedIn.identifier,hash:c._loggedIn.hash,auth:t}),t&&(e=!0),h!==e&&v(e)}else h&&v(!1)}),E=(console.log(h),async()=>{var e=await apiReq("/p/getforum",{goto:l});e?.data&&o(e.data),_(e?.data?.id)}),_=async e=>{e=await apiReq("/p/loadthreads",{par:e??i?.id,parType:"forum",limit:25,offset:m});e?.data&&s(e.data)};console.log(i,d);var b=React.useCallback(e=>{u(!0)}),C=React.useCallback(e=>{u(!1)}),P=React.useCallback((e,t,a,l,n,r,i,o)=>{submitPost(e,c,t,a,l,n,null,null,r,i,o),u(!1),_()});const w=React.useCallback(e=>{e?.currentTarget?.getAttribute&&(e=e.currentTarget.getAttribute("i"),R(Number(e)),E(e*c?.limit??100))});var I=[m-2,m-1,m,m+1,m+2];return React.createElement("div",{className:c.className+" GetThread_Container"},React.createElement("div",{className:"PagePadding"},h?a?.q?React.createElement("div",null,React.createElement(ThreadPage,_extends({},c,{q:a.q}))):React.createElement("div",null,l?React.createElement("div",null,React.createElement(LoadForums,_extends({},c,{goto:l})),i&&"url"!==i?.meta?.parentType&&i?.id?React.createElement("div",null,e?React.createElement("div",{className:"Post_ReplyExternalContainer"},React.createElement(AddComment,_extends({},c,{addComment:!0,opId:i.id,opIdType:"forum",handleCancelReply:C,sub:!1,defaultWriting:!0,commentPlaceholder:"Thread...",type:"forum",handlePost:P}))):React.createElement("button",{className:"action_button",style:{marginBottom:".5rem"},onClick:b},"Create",React.createElement("div",{className:"material-icons"},"add"))):null):null,d?.map?d.map((e,t)=>React.createElement("div",{key:t},React.createElement("div",{className:"LoadForums_ThreadLinkContainer"},React.createElement("a",{href:e?.id?l+"?q="+e.id:""},e?.title)))):null,React.createElement("ul",{className:"PaginationContainer"},I.map((e,t)=>-1<e&&e>=m&&100<=d?.length?React.createElement("li",{className:e==m?"ActivePage":"",key:t,i:e,onClick:w},e+1):null))):null))};export default Module;